<?phpnamespace Supervise\Controller;use Common\Controller\BaseController;class SuperviseoutstandingController extends BaseController{    /**     * @name:supervise_communist_outstanding_index     * @desc：优秀党员党员列表     * @param：     * @author：杨凯     * @addtime:2017-11-29     * @version：V1.0.0     **/    public function supervise_communist_outstanding_index()    {        $type = I('get.type');        checkAuth(ACTION_NAME . $type);        $this->assign('type', $type);        $this->display("supervise_communist_outstanding_index");    }    /**     * @name:supervise_communist_outstanding_data     * @desc：评优表数据查询     * @param：     * @author：杨凯     * @addtime:2017-11-29     * @version：V1.0.0     **/    public function supervise_communist_outstanding_data()    {        $page = I('get.page');        $pagesize = I('get.limit');        $page = ($page-1)*$pagesize;        $str = I('get.start_time');        $type = I('get.type');        $strt = strToArr($str, ' - '); //分割时间        $start_time = $strt[0];        $end_time = $strt[1];        $confirm = 'onclick="if(!confirm(' . "'确认删除？'" . ')){return false;}"';        $staff_no = session('staff_no');        $outstanding_data = getSuperviseOutstandingList('', $page, $pagesize, $start_time, $end_time, $type);        $communist_li = M('ccp_communist')->getField('communist_no,communist_name');        $staff_list_arr = M('hr_staff')->getField('staff_no,staff_name');        $party_li     = M('ccp_party')->getField('party_no,party_name');        $status_map['status_group'] = 'outstanding_status';        $status_li    = M('bd_status')->where($status_map)->getField('status_no,status_name');        $status_co    = M('bd_status')->where($status_map)->getField('status_no,status_color');        $is_good = checkDataAuth($staff_no,'is_good'); // 判断是否有审核优秀党员和优秀党组织的权限        foreach ($outstanding_data['data'] as &$outstanding) {            $outstanding['add_time'] = getFormatDate($outstanding['add_time'], 'Y-m-d');            if(!empty($outstanding['update_time'])){                $outstanding['update_time'] = getFormatDate($outstanding['update_time'], 'Y-m-d');            }            $outstanding['update_staff'] = $staff_list_arr[$outstanding['update_staff']]; //getCommunistInfo($outstanding['update_staff'], 'communist_name');            $outstanding['party_no']         = $party_li[$outstanding['party_no']];            $outstanding['communist_no']     = $communist_li[$outstanding['communist_no']];            $outstanding['operate']          = "<a class='layui-btn layui-btn-del layui-btn-xs' href='" . U('supervise_communist_outstanding_del', array('outstanding_id' => $outstanding['outstanding_id'], 'type' => $type)) . "' $confirm><i class='fa fa-trash-o'></i>删除</a>";            $outstanding['status_name'] = "<font color='" . $status_co[$outstanding['status']] . "'>" . $status_li[$outstanding['status']] . "</font> ";             if ($outstanding['status'] == 0 && $is_good) {                 $outstanding['operate'] .= "<a class='layui-btn  layui-btn-xs layui-btn-f60' href='" . U('supervise_communist_outstanding_status', array('outstanding_id' => $outstanding['outstanding_id'], 'type' => $type)) . "' target='_self'><i class='fa fa-edit'></i>通过审核</a>";            }        }        ob_clean();$this->ajaxReturn($outstanding_data);    }    /**     * @name:supervise_communist_outstanding_del     * @desc:删除评优表数据     * @param：     * @author：杨凯     * @addtime:2017-11-29     * @version：V1.0.0     **/    public function supervise_communist_outstanding_del()    {        $type = I('get.type');        checkAuth(ACTION_NAME);        $supervise_outstanding = M('supervise_outstanding');        $outstanding_id = I('get.outstanding_id');        $outstanding_data = $supervise_outstanding->delete($outstanding_id);        if ($outstanding_data) {            showMsg('success', '操作成功！！！', U('supervise_communist_outstanding_index', array('type' => $type)));        } else {            showMsg('error', '操作失败！！！', '');        }    }    /**     * @name:supervise_communist_outstanding_status     * @desc:修改评优表数据状态     * @param：     * @author：杨凯     * @addtime:2017-11-29     * @version：V1.0.0     **/    public function supervise_communist_outstanding_status()    {        $type = I('get.type');        checkAuth(ACTION_NAME);        $supervise_outstanding = M('supervise_outstanding');        $outstanding['outstanding_id'] = I('get.outstanding_id');        $outstanding['status'] = 1;        $outstanding['update_staff'] = $this->staff_no;        $outstanding['update_time'] = date("Y-m-d H:i:s");        $outstanding_data = $supervise_outstanding->save($outstanding);        if ($outstanding_data) {            showMsg('success', '操作成功！！！', U('supervise_communist_outstanding_index', array('type' => $type)));        } else {            showMsg('error', '操作失败！！！', '');        }    }    }