<?phpnamespace Iclock\Controller;use Think\Controller;ob_end_clean(); header('Content-type: text/plain');header("HTTP/1.1 200 OK");class GetRequestController extends Controller {    public function index(){	//$ceshi=M("ceshi");        $hr_communist=M("ccp_communist");        $hr_communist_bio=M("ccp_communist_bio");        $hr_att_machine=M("oa_att_machine");        //检测考勤表命令字段是否有要执行的命令        //是否接收到考勤机编号        $SN=I("get.SN");        if(!empty($SN)){                      //判断是否有考勤机需要执行上传指令            $wherestr['machine_no']=$SN;            $command_status=$hr_att_machine->where($wherestr)->getField("command_status");			$party_no=$hr_att_machine->where($wherestr)->getField("party_no");            if(!empty($command_status)){                if($command_status=='1'){                    //考勤机上传信息                    echo "C:123:CHECK\n";                    $save_data['command_status']='0';                    $change_status=$hr_att_machine->where($wherestr)->save($save_data);                }                elseif($command_status=='2'){                    //判断是否有考勤机需要执行下载指令                    //考勤机下载信息                    //下载人员数据                    $communists=array();										$party_map['party_no']=$party_no;                    $communists=$hr_communist->where($party_map)->select();					if(!empty($communists)){												foreach($communists as $v2){                          							$content=iconv("utf-8","gb2312//IGNORE",$v2['communist_name']);							echo "C:123:DATA UPDATE USERINFO PIN=".$v2['communist_no']."\tName=".$content."\tGrp=".$v2['party_no']."\n";                                    						}						//下载指纹数据						$communist_bios=array();						$communist_bios=$hr_communist_bio->where("bio_type = 'FP'")->select();						foreach($communist_bios as $v3){							echo "C:123:DATA UPDATE FINGERTMP PIN=".$v3['communist_no']."\tFID=0\tSize=".strlen($v3['bio_no'])."\tValid=1\tTMP=".$v3['bio_no']."\n";  						}					} else {						echo "C:123:CHECK\n";												$save_data['command_status']='0';						$change_status=$hr_att_machine->where($wherestr)->save($save_data);					}                }else{                    echo "OK";                }            }            echo "OK";        }//        else{//        	echo "OK";//        }    }}